# 사용자 모드와 커널 모드

### 	CPU Protection Rings

- CPU도 권한 모드라는 것을 가지고 있음

  - 사용자모드

  - 커널 모드

    - 특권 명령어 실행과 원하는 작업 수행을 위한 자원 접근을 가능케 하는 모드

    <img src="C:\Users\MIN\TIL\zero-base\1121_OS_UserKernellMode.assets\image-20211121233223515.png" alt="image-20211121233223515" style="zoom:50%;" />

    - 대부분의 운영체제는 Ring 0,3 만 사용
    - 3: 사용자모드
    - 0: 커널모드

- 두 가지 모드

  - 사용자 모드: 응용 프로그램이 사용
  - 커널 모드: OS 가 사용

### 응용 프로그램과 운영체제

- 어떤 명령은 사용자 영역에서, 어떤 명령은 커널 모드에서 실행됨
- CPU 사용 시: 응용 프로그램에서 API 통해 시스템 콜 호출 -> 운영체제로 들어가 커널 모드에서 실행됨
- 시스템콜은 커널 모드로 실행
  - 커널 모드에서만 실행 가능한 기능들이 있음
  - **커널 모드로 실행하려면, 반드시 시스템 콜을 거쳐야 함**
  - 시스템 콜: 운영체제 제공
- 예시
  1. 사용자 프로그램에서 `open()`함수 호출
  2. `unistd.h`파일을 통해 시스템 콜 사용 -> 커널 모드 실행됨
  3. `open()`이 호출되면 커널 모드에서 `sys_open()`함수 호출됨
  4. 파일을 열어 연산 수행
  5. 사용자 모드로 전환되어 값 반환



### 정리

- 운영체제는 시스템 콜 제공
- 프로그래밍 언어별로 운영체제 기능을 활용하기 위해 시스템 콜을 기반으로 API 제공
- 응용 프로그램은 운영체제 기능 필요시, 해당 API를 사용해 프로그램 작성
  1. 응용 프로그램 실행되어 **운영체제 기능 필요한 API를 호출**
  2. **시스템 콜 호출됨**
  3. **커널 모드로 변경**되어 **OS 내부**에서 해당 명령 실행
  4. **다시 응용 프로그램으로 돌아감**