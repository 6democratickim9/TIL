# NAT Gateway

> NAT(네트워크 주소 변환) 서비스

- 프라이빗 서브넷의 인스턴스가 VPC 외부의 서비스에 연결할 수 있지만 **외부 서비스에서 이러한 인스턴스와의 연결을 시작할 수 없도록 NAT 게이트웨이를 사용**

  **연결 유형 중 하나를 지정**

  - **퍼블릭**
    - (기본값) 프라이빗 서브넷의 인스턴스는 퍼블릭 NAT 게이트웨이를 통해 인터넷에 연결할 수 있지만 **인터넷에서 원치 않는 인바운드 연결을 수신할 수 없음**
    - 퍼블릭 서브넷에서 **퍼블릭 NAT 게이트웨이를 생성**하고 생성 시 **탄력적 IP 주소를 NAT 게이트웨이와 연결**
  - **프라이빗**
    - 프라이빗 서브넷의 인스턴스는 **프라이빗 NAT 게이트웨이를 통해 다른 VPC 또는 온프레미스 네트워크에 연결**
    - 트래픽을 **NAT 게이트웨이에서 Transit Gateway 또는 가상 프라이빗 게이트웨이를 통해 트래픽을 라우팅**
    - 프라이빗 NAT 게이트웨이를 사용하여 VPC에 인터넷 게이트웨이를 연결할 수 있지만 **프라이빗 NAT 게이트웨이에서 인터넷 게이트웨이로 트래픽을 라우팅하는 경우 인터넷 게이트웨이가 트래픽을 삭제**

- NAT 게이트웨이는 **인스턴스의 소스 IP 주소를 NAT 게이트웨이의 IP 주소**로 바꾼다
- 퍼블릭 NAT 게이트웨이의 경우 이것은 **NAT 게이트웨이의 탄력적 IP 주소**
- 인스턴스에 응답 트래픽을 전송할 때 NAT 디바이스는 주소를 **원래 소스 IP 주소로 다시 변환**



## 기본 사항

- 각 NAT 게이트웨이는 **특정 가용 영역에 생성**되고 해당 영역에서 **중복성을 통해 구현**

- 가용 영역에서 만들 수 있는 **NAT 게이트웨이 개수에는 할당량 존재**

- 여러 가용 영역에 리소스가 있고 NAT 게이트웨이 하나를 공유하는 경우, NAT 게이트웨이의 가용 영역이 다운되면 **다른 가용 영역의 리소스도 인터넷에 액세스할 수 없게 됨**

- ### 특성 및 규칙

  - NAT 게이트웨이는 **TCP, UDP, ICMP 등의 프로토콜을 지원**
  - NAT 게이트웨이는 **IPv4 또는 IPv6 트래픽에 대해 지원**
  - NAT 게이트웨이는 **5Gbps의 대역폭을 지원**
  - 패킷 손실을 방지하려면 리소스를 **여러 서브넷으로 분할하고 각 서브넷에 대해 별도의 NAT 게이트웨이를 생성**
  - NAT 게이트웨이에 대한 **`ErrorPortAllocation` CloudWatch 지표를 통해 55,000개보다 더 많은 연결에서 발생하는 포트 할당 오류 모니터링**
  - 연결된 후에는 NAT 게이트웨이에서 **탄력적 IP 주소의 연결을 끊을 수 없음**
  - NAT 게이트웨이에 다**른 탄력적 IP 주소를 사용**하려면 **새로운 NAT 게이트웨이를 만들고 라우팅 테이블을 업데이트**

