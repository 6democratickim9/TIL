## VPC

>  AWS 계정 전용 가상 네트워크

- 한 AWS 리전 안에서만 존재할 수 있음

- 연속적인 IP주소 범위로 구성 => CIDR 블록으로 표시

  - 10.0.0.0/8	=> 10.0.0.0 ~ 10.255.255.255
  - 172.16.0.0/12 => 172.16.0.0 ~ 172.31.255.255
  - 192.168.0.0/16 => 192.168.0.0 ~ 192.168.255.255

- 한 region 에 만든 VPC는 다른 region 에서는 보이지 않는다.

  => region 별로 만들 수 있다

  - Region
    - AWS 서비스가 운영되는 지역
    - 복수개의 데이터 센터들의 집합
    - https://aws.amazon.com/ko/about-aws/global-infrastructure/





#### **가용영역**

	- region 내에 위치한 데이터 센터
- 물리적으로 분리되어 있음 => 고가용성을 보장하기 위해

- 같은 VPC 안에 존재한다는 것 -> IP 주소로 표현 가능



#### 서브넷

 - VPC 내에서 공간을 나눈다 -> VPC내 논리 컨테이너
 - EC2 인스턴스를 배치하는 장소 => 인스턴스는 서브넷 안에 위치
   	- 서브넷에 인스턴스를 생성하면 다른 서브넷으로 이동할 수 없음
   	- 인스턴스를 종료하고 다른 서븐ㅅ에 새 인스턴스를 생성
- 인스턴스를 서로 격리하고, 인스턴스 간의 트래픽 흐름을 제어하고, 인스턴스를 기능별로 묶는 역할을 함
  - 서비스 제공 시 대외적으로 나가는 서비스와 대외적으로 나가지 않는 서비스 구분
  - 웹서비스-> 나감 / DB-> 안나감
- 서브넷 CIDR 블록
  - VPC의 일부, VPC 내에서는 유니크해야 함
  - VPC는 우리 네트워크 내에서 내가 논리적으로 나눈 것이기 때문 => 서로 달라야 함
  - 모든 서브넷은 처음 4개의 IP와 마지막 1개는 예약되어 있으므로 인스턴스에 할당할 수 없다
    - 서브넷의 CIDR가 171.16.100.0/24 인 경우
      - 172.16.100.0 ~ 172.16.100.3 와 172.16.100.255  는 사용불가
  - 서브넷은 하나의 가용 영역 내에서만 존재

- 가용 영역 내에서만 만들 수 있다

![image-20210226132149995](C:\Users\MIN\AppData\Roaming\Typora\typora-user-images\image-20210226132149995.png)



#### ENI (Elastic Network Interface)

> 탄력적 네트워크 인터페이스

- 가상화를 기반으로-> (가상화: 모든 하드웨어적 자원을 소프트웨어적으로 표현)
- 물리 서버의 NIC와 같은 기능을 수행
  - Network Interface Controller
- 모든 인스턴스에는 기본 ENI가 존재
- 인터페이스는 하나의 서브넷에만 연결
- 서버에는 한 개 이상의 네트워크 카드(단자 하나라서 해당 서브넷 코어와만 연결됨)가 연결되어 있다



#### IGW (Internet Gateway)

> 다른 네트워크로 나가는 통로

- PC에서 LAN환경 규정 시 -> ipconfig 명령 하면 서브넷 마스크와 ip 주소가 나옴
- 퍼블릭 IP 주소를 할당받은 인스턴스가 인터넷과 연결되어서 인터넷으로부터 요청을 수신할 수 있도록 해 주는 서비스 (인터넷과 연결해주는 서비스)

- 처음 VPC를 생성하더라도 IGW 가 연결되지는 않는다

  => 직접 IGW를 생성하고 VPC와 연결해야 함

- VPC는 하나의 인터넷 게이트웨이와만 연결할 수 있음

- 한 VPC 안의 모든 인스턴스들은 하나의 IGW로만 나간다

  



#### 라우팅 테이블

>  호스트를 다른 호스트로 연결해주는 과정

- 하드웨어적인 장비로도 가능/ 소프트웨어적으로도 가능

- AWS에서 VPC는 소프트웨어 함수로 IP 라우터를 제공

  => 사용자는 라우팅 테이블만 관리하면 된다

  - 어디서 어디로 갈지만 명시해주면 된다

- 라우팅 테이블은 하나 이상의 라우팅과 하나 이상의 서브넷 연결로 구성되어 있다

- VPC를 생성하면 기본 라우팅 테이블을 자동으로 만들고 해당 VPC의 모든 서브넷과 연결되어 있음



#### 라우팅

> 라우팅 테이블과 연결된 서브넷 내 인스턴스에서 트래픽을 전달하는 방법을 결정

- 라우팅 테이블에는 같은 VPC에 있는 인스턴스 간에 통신할 수 있게 하는 로컬 라우팅이 필수적으로 포함
- 기본 라우팅
  - 인스턴스가 인터넷에 액세스하게 하려면 IGW를 가리키는 기본 라우팅을 생성해야 함
    - 대상주소 (target address)
    - 대상

- 퍼블릭 서브넷: IGW를 가리키는 기본 라우팅이 포함된 라우팅 테이블과 연결된 서브넷
- 프라이빗 서브넷: 기본 라우팅이 포함되어 있지 않음
- 라우팅을 결정할 때는 가장 근접하게 일치하는 항목을 기반으로 라우팅



#### 보안 그룹 (Security Group)

> 방화벽과 같은 기능 제공

- 상태 저장 방화벽 역할
- 보안 그룹이 트래픽을 한 방향으로 전달되도록 허용할 때 반대 방향의 응답 트래픽을 지능적으로 허용

- 인스턴스의 ENI에서 송수신되는 트래픽을 허가해서 인스턴스를 오가는 트래픽을 제어
- 모든 ENI는 최소 하나 이상의 보안 그룹과 연결되어야 함
  - 보안 그룹과 ENI는 N:N 관계
  - 하나의 네트워크 카드는 여러 개의 보안그룹을 가질 수 있다
- 보안 그룹 생성 시 보안 그룹 이름, 설명, 포함될 VPC를 지정하고, 보안 그룹 생성 후에 인바운드 아웃바운드(내부에서 외부로 나가는 것 제어) 규칙을 지정해서 트래픽 제어



#### NACL (Network Access Control List)

>  1개 이상의 서브넷 내부와 외부의 트래픽을 제어하기 위한 방화벽 역할을 하는 VPC를 위한 선택적 보안 계층

- 보안 그룹과 유사

  - 원본, 대상, 주소의 CIDR, 프로토콜, 포트를 기반으로 트래픽 허용하는 인바운드, 아웃바운드 규칙을 포함

    => 방화벽 기능

  - VPC에는 삭제할 수 없는 기본 NACL이 존재

- NACL은 ENI가 아닌 서브넷에 연결, 해당 서브넷과 송수신하는 트래픽 제어

  - 서브넷 내의 인스턴스 간 트래픽을 제어할 때는 NACL을 사용할 수 없음

- NACL은 상태를 저장하지 않음 = 통과하는 연결 상태를 추적하지 않음

  - 모든 인바운드, 아웃바운드 트래픽의 허용 규칙을 별도로 작성해야 함

- NACL 규칙은 규칙 번호의 오름차순으로 처리

  













---------------

### 1. Instance

### 2. 서브넷

### 3. Traffic

4. 인바운드
5. 아웃바운드

6. SSH