#### 메타데이터 생성

ffprobe 프로그램을 사용해서 동영상 파일의 정보를 추출

ffprobe: 윈도우 환경에서는 실행 속성 설정 문제가 있어서 Amazon Linux EC2 인스턴스 생성해서 해당 인스턴스 내에서 실행



1. Amazon Linux EC2 인스턴스 생성

   

![image-20210312133845586](C:\Users\MIN\AppData\Roaming\Typora\typora-user-images\image-20210312133845586.png)

![image-20210312133853032](C:\Users\MIN\AppData\Roaming\Typora\typora-user-images\image-20210312133853032.png)

2. SSH 접속 후 node.js 설치

참고 ⇒ https://docs.aws.amazon.com/ko_kr/sdk-for-javascript/v2/developer-guide/setting-up-node-on-ec2-instance.html

![image-20210312134414159](C:\Users\MIN\AppData\Roaming\Typora\typora-user-images\image-20210312134414159.png)

```
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.34.0/install.sh | bash

. ~/.nvm/nvm.sh

nvm install node

  node -e "console.log('Running Node.js ' + process.version)"

nvm install v12.19.0
```

3. 인스턴스의 리눅스 버전에 해당하는 ffmpeg 정적 빌드 다운로드

   맞는 것 가져오는 것이 중요! => 맞는 것 찾는 법은 aws 공식 문서 참조.

   

![image-20210312135028428](C:\Users\MIN\AppData\Roaming\Typora\typora-user-images\image-20210312135028428.png)

이거 받아야됨

```wget https://www.johnvansickle.com/ffmpeg/old-releases/<받을 파일 이름>```

로 다운받는다

파일 이름 안붙이면 index.html이 다운됨ㅋㅋㅋ하,,,

``` xz -d ffmpeg-4.2.2-amd64-static.tar.xz```

압축해제

``` tar xvf ffmpeg-4.2.2-amd64-static.tar```

```cd ffmpeg-4.2.2-amd64-static/```

```ll```

해서 확인





4. **세번째 람다 함수 생성**

- 동영상 파일(트랜스 코딩된 동영상 파일, 3개가 생성)의 메타 정보를 추출해서 S3 버킷(트랜스 코딩된 파일이 저장되는 버킷)에 저장하는 람다 함수
- ![image-20210312135950924](C:\Users\MIN\AppData\Roaming\Typora\typora-user-images\image-20210312135950924.png)

![image-20210312140003693](C:\Users\MIN\AppData\Roaming\Typora\typora-user-images\image-20210312140003693.png)

5. 세번째 람다 함수 소스 코드 작성

EC2 인스턴스에서 작업 => ffprobr를 람다에 포함해서 배포해야 함

![image-20210312140324555](C:\Users\MIN\AppData\Roaming\Typora\typora-user-images\image-20210312140324555.png)